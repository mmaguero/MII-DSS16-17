<!-- Mercadeo BPEL Process [Generated by the Eclipse BPEL Designer] -->
<!-- Date: Mon Dec 26 03:26:46 CET 2016 -->
<bpel:process name="Mercadeo" targetNamespace="http://eclipse.org/bpel/mercadeo"
	suppressJoinFailure="yes" xmlns:tns="http://eclipse.org/bpel/mercadeo"
	xmlns:cmp="http://eclipse.org/bpel/comprador" xmlns:vnd="http://eclipse.org/bpel/vendedor"
	xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
	xmlns:xsd="http://www.w3.org/2001/XMLSchema">

	<!-- Import the client WSDL -->
	<bpel:import location="MercadeoArtifacts.wsdl" namespace="http://eclipse.org/bpel/mercadeo"
		importType="http://schemas.xmlsoap.org/wsdl/" />
	<bpel:import location="CompradorArtifacts.wsdl" namespace="http://eclipse.org/bpel/comprador"
		importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
	<bpel:import location="VendedorArtifacts.wsdl" namespace="http://eclipse.org/bpel/vendedor"
		importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>

	<!-- ================================================================= -->
	<!-- PARTNERLINKS -->
	<!-- List of services participating in this BPEL process -->
	<!-- ================================================================= -->
	<bpel:partnerLinks>
		<!-- The 'client' role represents the requester of this service. -->
		<bpel:partnerLink name="client" partnerLinkType="tns:Mercadeo"
			partnerRole="MercadeoProvider" />

		<bpel:partnerLink name="pnlkComprador"
			partnerLinkType="cmp:Comprador" myRole="CompradorProvider" />

		<bpel:partnerLink name="pnlkVendedor"
			partnerLinkType="vnd:Vendedor" partnerRole="VendedorProvider"></bpel:partnerLink>

	</bpel:partnerLinks>

	<!-- ================================================================= -->
	<!-- VARIABLES -->
	<!-- List of messages and XML documents used within this BPEL process -->
	<!-- ================================================================= -->
	<bpel:variables>
		<!-- Reference to the message passed as input during initiation -->
		<bpel:variable name="input" messageType="tns:MercadeoRequestMessage" />

		<bpel:variable name="tmpOutput" type="xsd:boolean"></bpel:variable>

		<!-- Reference to the message that will be returned to the requester -->
		<bpel:variable name="output" messageType="tns:MercadeoResponseMessage" />

		<bpel:variable name="pnlkVendedorResponse" messageType="vnd:VendedorResponseMessage"></bpel:variable>
		<bpel:variable name="pnlkVendedorRequest" messageType="vnd:VendedorRequestMessage"></bpel:variable>
	</bpel:variables>

	<!-- ================================================================= -->
	<!-- ORCHESTRATION LOGIC -->
	<!-- Set of activities coordinating the flow of messages across the -->
	<!-- services integrated within this business process -->
	<!-- ================================================================= -->
	<bpel:sequence name="main">

		<!-- Receive input from requester. Note: This maps to operation defined 
			in Mercadeo.wsdl -->
		<bpel:receive name="receiveInput" partnerLink="client"
			portType="tns:Mercadeo" operation="process" variable="input"
			createInstance="yes" />

		<!-- Generate reply to synchronous request -->
		<bpel:repeatUntil name="RepeatUntil">
			<bpel:sequence>
				<bpel:invoke name="InvokeVendedor" partnerLink="pnlkVendedor"
					operation="process" portType="vnd:Vendedor" inputVariable="pnlkVendedorRequest"
					outputVariable="pnlkVendedorResponse"></bpel:invoke>

				<bpel:assign validate="no">
					<bpel:copy>
						<bpel:from part="payload" variable="pnlkVendedorResponse">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[vnd:precio]]></bpel:query>
						</bpel:from>
						<bpel:to part="payload" variable="input">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                <![CDATA[cmp:precio]]>
							</bpel:query>
						</bpel:to>
					</bpel:copy>
				</bpel:assign>

				<bpel:invoke name="InvokeComprador" partnerLink="client"
					operation="process" portType="tns:Mercadeo" inputVariable="input"
					outputVariable="output"></bpel:invoke>

				<bpel:assign validate="no">
					<bpel:copy>
						<bpel:from part="payload" variable="output"></bpel:from>
						<bpel:to variable="tmpOutput"></bpel:to>
					</bpel:copy>
				</bpel:assign>

			</bpel:sequence>

			<bpel:condition>
                <![CDATA[boolean($tmpOutput)=boolean(true)]]>
			</bpel:condition>

		</bpel:repeatUntil>

		<bpel:reply name="replyOutput" partnerLink="client"
			portType="tns:Mercadeo" operation="process" variable="output" />
	</bpel:sequence>
</bpel:process>

